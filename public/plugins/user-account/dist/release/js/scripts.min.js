function UserFormService(n){function e(n){var e=!0;return $.each(n,function(n,i){(tscLib.userService.validate[$(i).attr("type")]||function(){return!0})($(i).val())||(e=!1,$(i).addClass("invalid").next().addClass("active").focus())}),e}function i(){$.each(tscLib["user-account"].templates,function(n,e){a.pluginUI.append($(e.content).hide())})}let t=n.config||{},o=n.options||{},s=null;const a=this;a.pluginUI=$("<div ></div>");const c={};a.canAccessPage=function(){let n=location.pathname.replace(/\//g,"");if(t.locked_uris=t.locked_uris||[],tscLib.userService.isLoggedIn())return!0;let e=!0;return $.each(t.locked_uris,function(i,t){let o=t.replace(/\//g,"");if(n===o)return e=!1}),e},a.showForm=function(n,e){const i=a._pluginDiv||$(o.container_selector);i.find("form").hide();var t=i.find("form#"+n);t&&t.length>0&&(t.show(),e&&a.renderContentData(t,e))},a.showUserAccountModal=function(){return new Promise(function(n,e){`<div class="modal fade " id="user-account-modal" tabindex="-1" role="dialog" aria-labelledby="user-account-modalLabel" aria-hidden="true">\n        <div class="modal-dialog" role="document">\n          <div class="modal-content">\n            <div id="user-account-modal-body" class="modal-body d-block p-5 text-center ">\n              ...\n            </div>\n          </div>\n        </div>\n      </div>`;let i=$("body #user-account-modal");i.length<1&&(i=$('<div class="modal fade " id="user-account-modal" tabindex="-1" role="dialog" aria-labelledby="user-account-modalLabel" aria-hidden="true">\n        <div class="modal-dialog" role="document">\n          <div class="modal-content">\n            <div id="user-account-modal-body" class="modal-body d-block p-5 text-center ">\n              ...\n            </div>\n          </div>\n        </div>\n      </div>'),$("body").append(i)),(s=i).on("show.bs.modal",function(e){n({})}),s.find("#user-account-modal-body").html("").append(a.pluginUI),s.modal({backdrop:"static",keyboard:!1}),a._pluginDiv=s,a.renderProvidersUI(),a.postRender()})},a.renderContentData=function(n,e){re=/{{([^}]*)}}/g;var i=c[n[0].id];i||(i=n.html(),c[n[0].id]=i),i=parseContentData(i,e),n.html(i)},a.renderPluginUI=function(){const n=$(o.container_selector);if(n.html(""),n.length>0)n.append(a.pluginUI),a._pluginDiv=n,a.renderProvidersUI(),a.postRender();else{let n=!1,e=location.hash||"";if((e=e.split("?")[0]||e)&&"#user-account"===e)n=!0;else{let e=location.search||"";$.each(e.replace("?","").split("&"),function(e,i){"user-account"===i.split("=")[0].toLowerCase()&&(n=!0)})}n&&a.showUserAccountModal()}tscLib.userService.postSignIn()},a.renderProvidersUI=function(){let n=tscLib.userService.options.providers;var e=a._pluginDiv.find(".providers-div").html("").addClass("row");$.each(n,function(n,i){const t=$(i.uiButton);t.on("click",function(n){n.preventDefault(),tscLib.userService.thirdPartySignIn(t.data("provider"))});const o=$('<div class="col-12 col-md-6 mt-3 p-0" ></div>').append(t);e.append(o)})},a.postRender=function(){tscLib.isUserAccountPage=!0;let n=a.getRedirectUri(),i=$("#user-info #user-info-continue-button-col").hide();n?(i.find("a").prop("href",n),i.show(),$("body").on("click","#user-info #user-info-continue-button-col a",function(n){try{s.modal("hide")}catch(n){}})):s&&s.length>0&&($("body").on("click","#user-info #user-info-continue-button-col a",function(n){try{s.modal("hide")}catch(n){}n.preventDefault()}),i.show().find("a").prop("href","#").html("close")),$("body").on("click",".user-account-div__sign-in-link",function(n){n.preventDefault(),a.showForm("sign-in")}),$("body").on("click",".user-account-div__sign-up-link",function(n){n.preventDefault(),a.showForm("sign-up")}),$("body").on("click",".user-account-div__sign-out-link",function(n){n.preventDefault(),tscLib.userService.signOut()}),$("body").on("submit"," #sign-up",function(n){const i=$(this).find("input");if(n.preventDefault(),e(i)){const n=$(this).find("input.email-input").val(),e=$(this).find("input.password-input").val(),i=$(this).find("input.name-input").val();tscLib.userService.signUp(n,e,i)}}),$("body").on("submit"," #sign-in",function(n){const i=$(this).find("input");if(n.preventDefault(),e(i)){const n=$(this).find("input.email-input").val(),e=$(this).find("input.password-input").val();tscLib.userService.signIn(n,e)}}),$("body").on("input","#sign-in input, #sign-in input",function(n){$(this).removeClass("invalid")})},a.getRedirectUri=function(){let n=[];try{n=(location.search||"").replace("?","").split("&").filter(n=>!!n)}catch(n){}try{(!n||n.length<1)&&(n=location.href.split("?")[1].split("&")||[])}catch(n){}try{n=n||[];let e={};$.each(n,function(n,i){let t=i.split("=");e[t[0]]=t[1]}),n=e}catch(n){}return n.redirectUrl},a.ensureProperAccess=function(){if(!tscLib.userService.isLoggedIn()&&!a.canAccessPage()){let n=t.user_account_uri;if(n&&!tscLib.isUserAccountPage){let e=location.href,i=location.protocol+"//"+location.host+"/"+n+"?redirectUrl="+e;location.href=i}}},a.setup=function(){i()},this.setup()}function UserService(n){function e(){const n=l.getUserInfo();n&&tscLib.userFormService.showForm("user-info",n)}function i(n){n.profileColor=t(n.email)}function t(n){let e=a(n,!0);e<u.length&&(e=u.length);let i=e%u.length;return u[i]}function o(n){n.initials=s(n.displayName)}function s(n){var e=n.replace(/[^a-zA-Z- ]/g,"").match(/\b\w/g);return e.join("").toUpperCase().substr(0,2)}function a(n,e=!0){for(var i="",t=0,o=0;o<n.length;o++){var s=n.toUpperCase().charCodeAt(o);s>64&&s<91&&(i+=s-64+" ",t+=s-64)}return e?t:i.slice(0,i.length-1)}let c=(n=n||{}).config||{},r=n.options||{};const l=this;signedOut=!1,l.postSignIn=e,l.signIn=function(n,i){firebase.auth().signInWithEmailAndPassword(n,i).then(n=>{e()}).catch(function(n){n.code,n.message;console.log(n)})},l.signOut=function(){signedOut=!0,firebase.auth().signOut().then(n=>{tscLib.userFormService.showForm("signed-out")})},l.getToken=function(){const n=l.getUserInfo();return n||l.redirectToLogin(),n.getIdToken()},l.signUp=function(n,e,i){firebase.auth().createUserWithEmailAndPassword(n,e).then(n=>{n.updateProfile({displayName:i}).then(function(){console.log("User updated",l.getUserInfo())}).catch(function(n){}),n.isVerified||n.sendEmailVerification().then(function(){console.log("Verification email sent")}).catch(function(n){})}).catch(function(n){n.code,n.message;console.log(n)})},l.getUserInfo=function(){return firebase.auth().currentUser},l.isLoggedIn=function(){let n=!1;try{n=JSON.parse(localStorage.getItem("logged_in"))}catch(n){}return n},l.redirectIfNotLoggedIn=function(n={}){let e={redirectToUrl:"",forceShowLogin:!0};$.extend(e,n),l.isLoggedIn()||l.redirectToLogin()},l.redirectToLogin=function(){let n=r.redirectToUrl,e=c.user_account_uri,i=location.href,t=location.href;i=n||(e?location.protocol+"//"+location.host+"/"+e:t),i+="#user-account?redirectUrl="+t,location.href=i},l.watchAuth=function(){firebase.auth().onAuthStateChanged(function(n){if($(document).trigger("tsc:user_service:ready",[n]),n){i(n),o(n),n.displayName=n.displayName||email;let t=n.photoURL?"":n.initials,s=`<div style="background-color:${n.profileColor.value};\n                background-image:url(${n.photoURL}); \n                background-size:cover; border-radius:50%; \n                margin:1rem;width:4rem; font-size:1.5rem; font-weight:300; height:4rem;\n                 line-height:3rem; text-align:center; color:white">${t}</div>`;n.profileAvatar=s,e(),localStorage.setItem("logged_in","true"),$(document).trigger("tsc:user_service:logged-in",[n])}else{localStorage.setItem("logged_in","false");const e=signedOut?"signed-out":"sign-in";$(document).trigger("tsc:user_service:"+(signedOut?"logged-out":"not-logged-in"),[n]),tscLib.userFormService.showForm(e)}})},l.validateEmail=function(n){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(n)},l.validatePassword=function(n){return n=n||"",$.trim(n).length>l.options.password_requirements.minLength},l.validate={email:l.validateEmail,password:l.validatePassword},l.options={password_requirements:{minLength:6},providers:[{name:"Google",uiButton:$(`<button class="btn btn-google btn-social-login waves-effect text-left">\n                <span class="row m-0">\n                <span class="col-auto p-0 pr-2"><img  \n                  src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg"></span><span class=" p-0 col\n                  d-none d-md-inline">Continue with Google</span><span class="p-0 col d-md-none">Continue with Google\n                  </span> </span></button>`).data("provider",new firebase.auth.GoogleAuthProvider),uiIcon:'<span class="firebaseui-idp-icon-wrapper"><img class="firebaseui-idp-icon" src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg"></span>'},{name:"Facebook",uiButton:$(`<button class="btn btn-facebook btn-social-login waves-effect text-left">\n               <span class="row m-0">\n               <span class="col-auto p-0 pr-2"><img  \n                 src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/facebook.svg"></span><span class=" p-0 col\n                 d-none d-md-inline">Continue with Facebook</span><span class="p-0 col d-md-none">Continue with Facebook\n                 </span> </span></button>`).data("provider",new firebase.auth.FacebookAuthProvider),uiIcon:'<span class="firebaseui-idp-icon-wrapper"><img class="firebaseui-idp-icon"                 src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/facebook.svg"></span>'}]},l.thirdPartySignIn=function(n){firebase.auth().signInWithPopup(n).then(function(n){n.credential.accessToken,n.user;console.log(n)}).catch(function(n){n.code,n.message,n.email,n.credential})};const u=[{name:"red",value:"#b71c1c"},{name:"purple",value:"#4a148c"},{name:"blue",value:"#1976d2"},{nae:"green",value:"#2e7d32"},{name:"orange",value:"#e65100"},{name:"gray",value:"#37474f"},{name:"pink",value:"#d81b60"}];l.setup=function(){l.watchAuth()},this.setup()}window.tscLib=window.tscLib||{},window.tscLib["user-account"]=window.tscLib["user-account"]||{},window.tscLib["user-account"].templates=[{filename:"sign-in.html",path:"forms/",full_path:"forms/sign-in.html",content:'<form id="sign-in" style="display:none;"  action="/plugins/form-wizard">\n    <div class="form-header">\n      <h3><i class="fa fa-lock"></i> Sign In</h3>\n    </div>\n    <p>We just need some information so we can get you started</p>\n    <br />\n    \x3c!-- Form log in --\x3e\n    <div class="md-form">\n      \x3c!-- <i class="fa fa-envelope prefix grey-text"></i> --\x3e\n      <input type="email" id="defaultForm-email" class="form-control email-input">\n      <label data-error="invalid email" for="defaultForm-email"><i class="fa fa-user-circle-o"></i>&nbsp; &nbsp; Your email</label>\n    </div>\n\n    <div class="md-form">\n      \x3c!-- <i class="fa fa-lock prefix grey-text"></i> --\x3e\n      <input type="password" id="defaultForm-pass" class="form-control password-input">\n      <label data-error="Invalid password" for="defaultForm-pass"><i class="fa fa-lock"></i>&nbsp; &nbsp; Your password</label>\n    </div>\n\n    <div class="text-center">\n      <button class="btn btn-default btn-lg">Sign in</button>\n    </div>\n    <br />\n    <p>\n      If you don\'t have an account yet <a class="user-account-divsign-in-link" href="#">sign in</a>\n    </p>\n    \x3c!-- Form register --\x3e\n<p>Other options</p>\n    <div class="providers-div">\n      \n                       \n                      </div>\n  </form>'},{filename:"signed-out.html",path:"forms/",full_path:"forms/signed-out.html",content:'<form id="signed-out" style="display:none;" action="/plugins/form-wizard">\n    <div class="form-header">\n      <p class="lead"> You have successfully signed out. <br/> <small>See you again soon</small></p>\n      <p>\n        <a class="user-account-divsign-in-link" href="#">sign in as a different user</a>\n      </p>\n      <div class="row">\n          <span class="col">\n              <button  class="btn btn-sm btn-secondary user-account-div__sign-out-link">Sign out</button>\n              </span>\n              <span id="user-info-continue-button-col" class="col">\n                  <a href="#" class="btn btn-sm btn-primary">Continue</a>\n                  </span>\n      </div>\n    </div>\n\n    \x3c!-- Form log in --\x3e\n  </form>'}],window.tscLib=window.tscLib||{},window.tscLib.user_account={},window.tscLib.user_account.preparePluginConfig=function(n){function e(n){(n=n||{}).config=n.config||{},n.config.namespace="user_account",n.options=n.options||{},n.config.locked_uris=n.config.locked_uris||["","/plugins/user-account/","/plugins/form-wizard/"],n.config.firebase=n.config.firebase||{},n.options.container_selector=n.options.container_selector||"#user-account-div.user-account-div",window.tscLib.user_account.initializePlugin(n)}(new HttpClient).get("https://login.elyir.com/projects//plugins/user_account/config/?use_sandbox=true",!1).then(function(n){e(n)}).catch(function(n){e()})},window.tscLib.user_account.initializePlugin=function(n){if(window.tscLib=window.tscLib||{},window.tscLib[n.config.namespace]=window.tscLib[n.config.namespace]||{},tscLib[n.config.namespace].initialized)return;firebase.initializeApp(n.config.firebase),tscLib[n.config.namespace].initialized=!0;n.options.container_selector;$(document).on("tsc:user_service:ready",function(e,i){Loader.hide("user-service-loader");const t=new UserFormService(n);window.tscLib.userFormService=t,window.requireUserLogin&&window.tscLib.userService.redirectIfNotLoggedIn(),t.renderPluginUI()});const e=new UserService(n);window.tscLib.userService=e},$(document).ready(function(){Loader.presentFullScreen({identifier:"user-service-loader",text:"Hang on, we are starting all the things..."}),window.tscLib.user_account.preparePluginConfig()});